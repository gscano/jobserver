.TH JOBSERVER 3q

.SH NAME
jobserver_getenv, jobserver_setenv - access the jobserver environment
variable

.SH SYNOPSIS
.nf
#include <jobserver.h>
.sp
.B "int jobserver_getenv(int * \fIread\fP, int * \fIwrite\fP, bool * \fIdry_run\fP);"
.br
.B "int jobserver_setenv(int \fIread\fP, int \fIwrite\fP, bool \fIdry_run\fP);"

.SH DESCRIPTION
The
.B jobserver_getenv()
function looks for the
.I read
and
.I write
file descriptors of the jobserver token pipe as well as its
.I dry_run
status. If the jobserver is non existant, the
.B jobserver_getenv()
function will set \fIread\fP and \fIwrite\fP to \fB-1\fP and
\fIdry_run\fP to \fBfalse\fP.


The
.B jobserver_setenv()
function sets the jobserver token pipe file descriptors
.I read
and
.I write
in the environment as well as the
.I dry_run
status.

.SH RETURN VALUE
On success, the
.B jobserver_getenv()
and
.B jobserver_setenv()
functions return \fB0\fP. On error, \fP-1\fP is returned and
.I errno
is set accordingly.

.SH ERROR

.TP
.B EBADF
One of the \fIread\fP or \fIwrite\fP file descriptor could not be parsed.

.TP
.B ENOMEM
Not enough memory to add or change the \fBMAKEFLAGS\fP environment variable.

.SH ENVIRONMENT
According to section 13.1.1 of the
.UR https://www.gnu.org/software/make/
GNU Make documentation
.UE ,
those fonctions respectively read and write the
.B MAKEFLAGS
environment variable. In particular, the letter \fBn\fP, corresponding
to the \fIdry_run\fP option, is looked up or inserted in the first
word of this variable. The string
.B --jobserver-auth=\fP\fIread\fP,\fIwrite\fP
is then examined or written.

The
.B jobserver_setenv()
function will modify the environment and should only be called if a call to
.B jobserver_getenv()
returned \fB0\fP and both file descriptors \fIread\fP
and \fIwrite\fP are \fB -1\fP.

.SH ATTRIBUTES
For an explanation of the terms used in this section, see
.BR attributes (7).
.ad l
.TS
allbox;
lb lb lb
l l l.
Interface	Attribute	Value
T{
.BR jobserver_getenv ()
T}	Thread safety	MT-Safe env, locale
T{
.BR jobserver_setenv ()
T}	Thread safety	MT-Unsafe const:env
.TE
.ad

.SH SEE ALSO
.BR jobserver(7)
