.TH JOBSERVER 3

.SH NAME
jobserver_getenv, jobserver_setenv - access the jobserver environment
variable

.SH SYNOPSIS
.nf
#include <jobserver.h>
.sp
.B "int jobserver_getenv(int * \fIread\fP, int * \fIwrite\fP, bool * \fIdry_run\fP, bool * \fIdebug\fP, bool * \fIKeep_going\fP);"
.br
.B "int jobserver_setenv(int \fIread\fP, int \fIwrite\fP, bool \fIdry_run\fP, bool \fIdebug\fP, bool \fIkeep_going\fP);"

.SH DESCRIPTION
The
.BR jobserver_getenv ()
function looks for the
.I read
and
.I write
file descriptors of the jobserver token pipe as well as its
\fIdry_run\fP, \fIdebug\fP, and \fIkeep_going\fP status.

The
.BR jobserver_setenv ()
function sets the jobserver token pipe file descriptors
.I read
and
.I write
in the environment as well as the
\fIdry_run\fP, \fIdebug\fP, and \fIkeep_going\fP statuses.

.SH RETURN VALUE
On success, the
.BR jobserver_getenv ()
and
.BR jobserver_setenv ()
functions return \fB0\fP. On error, \fP-1\fP is returned and
.I errno
is set accordingly.

The
.BR jobserver_getenv ()
function returns \fB0\fP and both \fIread\fP and \fIwrite\fP are set to \fB-1\fP
if the jobserver is non existant, either because the
\fBMAKEFLAGS\fP environment variable is not defined or because the
\fB--jobserver-auth\fP option is not used (see \fBENVIRONMENT\fP).
The \fIdry_run\fP, \fIdebug\fP, and \fIkeep_going\fP statuses, if present,
are always collected.

The
.BR jobserver_setenv ()
function overwrites any preexisting jobserver. When \fIread\fP and \fIwrite\fP
are negative, the jobserver is completely removed from the environment.

.SH ERROR

.TP
.B EBADF
(\fBjobserver_getenv\fP())
One of the \fIread\fP or \fIwrite\fP file descriptor could not be parsed.

.TP
.B ENOMEM
(\fBjobserver_setenv\fP())
Not enough memory to add or change the \fBMAKEFLAGS\fP environment variable.

.SH ENVIRONMENT
According to section 13.1.1 of the
.UR https://www.gnu.org/software/make/
GNU Make documentation
.UE ,
those fonctions respectively read and write the
.B MAKEFLAGS
environment variable. In particular, the letters \(aqn\(aq, \(aqd\(aq and \(aqk\(aq,
corresponding to the \fIdry_run\fP, \fIdebug\fP, and \fIkeep_going\fP options,
are looked up or inserted in the first word of this variable. The string
.B --jobserver-auth=\fP\fIread\fP,\fIwrite\fP
is then examined or written.

.SH ATTRIBUTES
For an explanation of the terms used in this section, see
.BR attributes (7).
.ad l
.TS
allbox;
lb lb lb
l l l.
Interface	Attribute	Value
T{
.BR jobserver_getenv ()
T}	Thread safety	MT-Safe env, locale
T{
.BR jobserver_setenv ()
T}	Thread safety	MT-Unsafe const:env
.TE
.ad

.SH SEE ALSO
.BR jobserver (7)
